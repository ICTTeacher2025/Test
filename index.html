<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload to Supabase (Private Bucket)</title>
</head>
<body>
  <h2>Upload to Supabase (Private Bucket)</h2>

  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>

  <p id="status"></p>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = 'https://cmqggcacudmfsdrpciwx.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtcWdnY2FjdWRtZnNkcnBjaXd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NDQzNzAsImV4cCI6MjA3MzUyMDM3MH0.VtvGAQ3gCDIYDkgwJZxrMNPf-W1qs8UVwqejp1I_CM8';
    const BUCKET = 'Test';

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const status = document.getElementById('status');

      if (!fileInput.files.length) {
        status.textContent = 'Please select a file.';
        return;
      }

      const file = fileInput.files[0];
      const filePath = `${Date.now()}_${file.name}`;

      status.textContent = 'Uploading...';

      const { data, error } = await supabase.storage
        .from(BUCKET)
        .upload(filePath, file);

      if (error) {
        status.textContent = '❌ Upload failed. See console.';
        console.error(error);
        return;
      }

      // Generate signed URL
      const { data: signedURL, error: urlError } = await supabase
        .storage
        .from(BUCKET)
        .createSignedUrl(filePath, 3600); // valid for 1 hour

      if (urlError) {
        status.textContent = '✅ Uploaded, but failed to create link.';
        console.error(urlError);
        return;
      }

      status.innerHTML = `✅ Upload successful.<br><a href="${signedURL.signedUrl}" target="_blank">Open File</a>`;
    }
  </script>
</body>
</html>
